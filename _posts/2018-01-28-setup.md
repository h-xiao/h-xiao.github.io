---
title: "Quantitative Trading Project"
date: 2019-09-01
#tags: [Python, SQL, data gathering, data cleaning, data storing]
header:
  image: "/images/stock.jpg"
mathjax: "true"
---

# Part 1: Getting Financial Data and Storing Data in MySQL


Note: this part assumes you have MySQL, Python, Anaconda installed. 

We will use the mysql.connector to connect to MySQL via Python. If you don't have this package installed, you will need to run this in command line:

```cmd
pip install mysql-connector-python
```


After that is installed, we can import in the package 

```python
import mysql.connector
```


And use this function to create our SQL database (called securities_db).

Note: we will have to set a hostname, username, and password which I've specified in a separate config. 

```python
def CreateDB:

    # Connect to the MySQL instance
    con = mysql.connector.connect(
        host = db_config['host'],
        user = db_config['user'],
        password = db_config['password'] )

    cur = con.cursor(buffered=True)
    cur.execute('CREATE DATABASE securities_db')
    con.commit()

    cur.execute('SHOW DATABASES')
    for db in cur:
        print (db)
```


After the database is set up, we will need to create tables to store the data. Since we don't know the format of the data that we will download yet, it might be good to set up these tables after.

Sample code to create a table:

```python
def CreateTB:

    # Connect to the MySQL instance
    con = mysql.connector.connect(
        host = db_config['host'],
        user = db_config['user'],
        password = db_config['password'],
        database = db_config['database'])

    cur = con.cursor(buffered=True)
    cur.execute('''CREATE TABLE tickers (id int NOT NULL AUTO_INCREMENT, 
    									ticker varchar(32) NOT NULL,
    									PRIMARY KEY (id)) ''')

    con.commit()

    cur.execute('SHOW TABLES')
    for tb in cur:
        print (tb)
```



# Part 2: Getting S&P historical daily price
Let's start off by getting historic data for tickers in S&P 500. We will first need the list of ticker symbols which we can get Wikipedia.

```python
import pandas as pd

data = pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')
table = data[0]
```


<img src="{{ site.url }}{{ site.baseurl }}/images/setup/sp_ticker_data.png" alt="linearly separable data">

This can be the first table that we store in MySQL. We will need to first create the table in MySQL:

```python
con = mysql.connector.connect(
        host = db_config['host'],
        user = db_config['user'],
        password = db_config['password'])
cur = con.cursor(buffered=True)

cur.execute('''CREATE TABLE sp_ticker_data (id int NOT NULL AUTO_INCREMENT, 
                                            symbol varchar(32) NOT NULL,
                                            security varchar(255) NOT NULL,
                                            sec_filings varchar(64) NULL,
                                            gics_sector varchar(255) NULL,
                                            gics_sub_industry varchar(255) NULL,
                                            headquarters_location varchar(255) NULL,
                                            date_first_added datetime NULL, 
                                            cik int NULL,
                                            founded int NULL,
                                            PRIMARY KEY (id))''')
```


Then we can store it:

```python
from sqlalchemy import create_engine

engine = create_engine('mysql://' + db_config['user'] + ':' + db_config['password'] + '@' + db_config['host'] + '/' + db_config['database'])
con = engine.connect()
table.to_sql(name='sp_ticker_data', con=con, if_exists='replace')
con.close()
```

We can use this function to query and return all the tables from the database in a dictionary of dataframes.

```
def get_tables_from_db(select_all, tbl_list):
    engine = create_engine('mysql://' + db_config['user'] + ':' + db_config['password'] + '@' + db_config['host'] + '/' + db_config['database'])
    con = engine.connect()

    tables_df = pd.read_sql('SHOW TABLES', con)
    frames_dict = {}
    if select_all == True:
        table_name_list = tables_df.Tables_in_securities_db
    else:
        table_name_list = tbl_list

    select_template = 'SELECT * FROM {table_name}'
    for tname in table_name_list:
        print ('getting table from db: ' + tname)
        query = select_template.format(table_name=tname)
        frames_dict[tname] = pd.read_sql(query, con)

    return frames_dict


frames_dict = get_tables_from_db(True, [])
```

Here is what the sp_ticker_data table looks like:

<img src="{https://github.com/h-xiao/h-xiao.github.io/images/setup/sp_ticker_data.png">
![alt](https://h-xiao.github.io/images/setup/sp_ticker_data.png)
<a href="/assets/images/setup/sp_ticker_data.png"><img src="/assets/images/setup/sp_ticker_data.png"></a>
<a href="/images/setup/sp_ticker_data.png"><img src="/images/setup/sp_ticker_data.png"></a
>
<img src="{{ site.url }}{{ site.baseurl }}/images/setup/sp_ticker_data.png">
![alt]({{ site.url }}{{ site.baseurl }}/images/setup/sp_ticker_data.png)

We will use the new Yahoo Finance package to get historic data. 

```python
import yfinance as yf

# where ticker is a string like 'AAPL'
def get_daily_historic_data_yf(ticker):
    data = yf.Ticker(ticker).history(period="max")
    return data
```

We can use the above to function to create a giant df containing all the tickers in S&P and adding an additional column called symbol_id to identify which tickers they are:

<img src="{https://h-xiao.github.io/images/setup/daily_data_yf.png">
![alt](https://h-xiao.github.io/images/setup/daily_data_yf.png)
<a href="/assets/images/setup/daily_data_yf.png"><img src="/assets/images/setup/daily_data_yf.png"></a>
<a href="/images/setup/daily_data_yf.png"><img src="/images/setup/daily_data_yf.png"></a>
<img src="{{ site.url }}/images/setup/daily_data_yf.png">
![alt](https://github.com/h-xiao/h-xiao.github.io/assets/images/setup/daily_data_yf.png)
![image](https://github.com/h-xiao/h-xiao.github.io/assets/images/setup/daily_data_yf.jpg)

<figure class="half">
    <a href="/images/setup/daily_data_yf.png"><img src="/images/setup/daily_data_yf.png"></a>
    <a href="/assets/images/setup/daily_data_yf.png"><img src="/assets/images/setup/daily_data_yf.png"></a>
    <figcaption>Caption describing these two images.</figcaption>
</figure>

![My helpful screenshot](assets/images/setup/daily_data_yf.png)





## Setting up MySQL connection in Python


















# H1 Heading

## H2 Heading

### H3 Heading

Here's some basic text.

And here's some *italics*

Here's some **bold** text.

What about a [link](https://github.com/dataoptimal)?

Here's a bulleted list:
* First item
+ Second item
- Third item

Here's a numbered list:
1. First
2. Second
3. Third

Python code block:
```python
    import numpy as np

    def test_function(x, y):
      z = np.sum(x,y)
      return z
```

R code block:
```r
library(tidyverse)
df <- read_csv("some_file.csv")
head(df)
```

Here's some inline code `x+y`.

Here's an image:
<img src="{{ site.url }}{{ site.baseurl }}/images/perceptron/linsep.jpg" alt="linearly separable data">

Here's another image using Kramdown:
![alt]({{ site.url }}{{ site.baseurl }}/images/perceptron/linsep.jpg)

Here's some math:

$$z=x+y$$

You can also put it inline $$z=x+y$$
